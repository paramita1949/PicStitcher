# GitHub Actions 自动打包使用指南

## 📦 已完成的配置

✅ 创建了 `.github/workflows/build-and-release.yml` 工作流文件  
✅ 创建了 `requirements-minimal.txt` 依赖文件  
✅ 创建了 `README.md` 项目说明文档  
✅ 已推送到 GitHub 仓库  

## 🚀 如何触发自动打包

### 方法一：使用 Git 命令（推荐）

```bash
# 1. 确保所有更改已提交
git add .
git commit -m "你的更新说明"

# 2. 创建版本标签（例如 v1.5.0）
git tag v1.5.0

# 3. 推送标签到 GitHub（这会触发自动打包）
git push origin v1.5.0

# 或者推送所有标签
git push --tags
```

### 方法二：在 GitHub 网页上创建 Release

1. 访问你的仓库：https://github.com/paramita1949/PicStitcher
2. 点击右侧的 "Releases"
3. 点击 "Create a new release"
4. 在 "Choose a tag" 中输入新标签，如 `v1.5.0`
5. 填写 Release 标题和说明
6. 点击 "Publish release"

## 📋 版本号命名规范

建议使用语义化版本号：

- `v1.0.0` - 主版本号.次版本号.修订号
- `v1.5.0` - 新功能发布
- `v1.5.1` - Bug 修复
- `V1.5.0` - 也支持大写 V

## 🔄 自动打包流程

当你推送标签后，GitHub Actions 会自动执行以下步骤：

1. ✅ **检出代码** - 获取最新代码
2. ✅ **设置 Python 3.11** - 配置 Python 环境
3. ✅ **安装依赖** - 安装 Pillow、numpy、PyInstaller 和 Nuitka
4. ✅ **安装 MSVC** - 配置 C++ 编译器（Nuitka 需要）
5. ✅ **提取版本号** - 从标签中提取版本信息
6. ✅ **使用 PyInstaller 打包** - 生成 Standalone 版本
7. ✅ **使用 Nuitka 打包** - 生成编译优化版本
8. ✅ **打包为 ZIP** - 将两个版本分别打包
9. ✅ **创建 Release** - 自动创建 GitHub Release
10. ✅ **上传文件** - 上传两个 ZIP 文件

## 📥 下载打包好的程序

1. 访问：https://github.com/paramita1949/PicStitcher/releases
2. 找到对应版本的 Release
3. 选择下载：
   - `PicStitcher-Nuitka-v1.5.0.zip` - Nuitka 版本（推荐，性能更好）
   - `PicStitcher-PyInstaller-v1.5.0.zip` - PyInstaller 版本（兼容性更好）
4. 解压后运行 `PicStitcher.exe`

## 🔍 查看打包进度

1. 访问你的仓库：https://github.com/paramita1949/PicStitcher
2. 点击顶部的 "Actions" 标签
3. 查看正在运行或已完成的工作流
4. 点击具体的工作流可以查看详细日志

## ⚠️ 常见问题

### 1. 打包失败怎么办？

- 点击 Actions 标签查看错误日志
- 检查 `requirements-minimal.txt` 中的依赖是否正确
- 确保 `main.py` 没有语法错误

### 2. 如何修改打包配置？

编辑 `.github/workflows/build-and-release.yml` 文件：

```yaml
# 修改 PyInstaller 参数
- name: Build with PyInstaller
  run: |
    pyinstaller --onefile --windowed --icon=icon.ico ...
```

### 3. 如何删除错误的标签？

```bash
# 删除本地标签
git tag -d v1.5.0

# 删除远程标签
git push origin :refs/tags/v1.5.0
```

### 4. 如何添加更多依赖？

编辑 `requirements-minimal.txt` 文件，添加需要的包：

```txt
Pillow==11.1.0
numpy==2.2.4
你的新依赖==版本号
```

## 📝 示例：发布新版本的完整流程

```bash
# 1. 修改代码
# ... 编辑 main.py 等文件 ...

# 2. 提交更改
git add .
git commit -m "v1.5.0: 添加新功能 - 支持 PNG 格式"

# 3. 推送到 GitHub
git push

# 4. 创建并推送标签
git tag v1.5.0
git push origin v1.5.0

# 5. 等待 8-12 分钟，GitHub Actions 自动打包（包含 PyInstaller 和 Nuitka 两个版本）

# 6. 访问 Releases 页面下载
# https://github.com/paramita1949/PicStitcher/releases
```

## 🎯 下一步建议

1. **测试自动打包**：创建一个测试标签（如 `v1.4.1`）测试工作流
2. **更新版本号**：在 `main.py` 中添加版本号显示
3. **完善文档**：更新 `updata.txt` 记录每个版本的更新内容
4. **添加图标**：确保 `icon.ico` 文件存在且格式正确

## 💡 提示

- 每次发布新版本前，建议先在本地测试打包是否成功
- 使用 `build_pyinstaller_fixed.bat` 测试 PyInstaller 打包
- 使用 `build_nuitka.bat` 测试 Nuitka 打包
- 使用 `build_all.bat` 同时测试两种打包方式
- 标签一旦推送就会触发打包，请谨慎操作
- 私有仓库的 Actions 有使用时长限制，注意配额

## 📊 两种打包方式对比

| 特性 | PyInstaller | Nuitka |
|------|-------------|--------|
| 打包速度 | ⚡ 快（2-3分钟） | 🐌 慢（5-8分钟） |
| 启动速度 | ✅ 正常 | 🚀 快 |
| 运行性能 | ✅ 良好 | 🚀 优秀 |
| 文件大小 | 📦 中等 | 📦 中等 |
| 兼容性 | ✅ 优秀 | ✅ 良好 |
| 推荐场景 | 快速测试、兼容性优先 | 正式发布、性能优先 |

---

**现在你可以尝试创建第一个版本了！**

```bash
git tag v1.5.0
git push origin v1.5.0
```

然后访问 https://github.com/paramita1949/PicStitcher/actions 查看打包进度！

